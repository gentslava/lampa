!function(){"use strict";function e(e){if(e){var n=e.still_path||e.episode&&e.episode.still_path||null,t=e.card||e.episode&&e.episode.card||null;e.backdrop_path||(e.backdrop_path=n||t&&(t.backdrop_path||t.poster_path)||e.poster_path||null),e.poster_path||(e.poster_path=n||t&&(t.poster_path||t.backdrop_path)||e.backdrop_path||null)}}function n(e){e&&(!e.backdrop_path&&e.screen&&(e.backdrop_path=e.screen),!e.poster_path&&e.screen&&(e.poster_path=e.screen),!e.poster_path&&e.card_poster&&(e.poster_path=e.card_poster),!e.title&&e.card_title&&(e.title=e.card_title),!e.release_date&&e.card_year&&(e.release_date=String(e.card_year)+"-01-01"))}function t(e,n){var t=e&&e.jquery?e[0]:e;if(t&&n&&n.length&&!a()){var i=new MutationObserver((function(){a()&&i.disconnect()}));i.observe(t,{childList:!0,subtree:!0})}function a(){var e=$(t).find(".card");return!!e.length&&(e.each((function(e){var t=n[e];if(t){var i=t.episode||t,a=i.air_date,r=i.episode_number;if(a&&null!=r){var o=$(this),s=o.find(".card__view");s.length||(s=o),s.find(".plugin-epmeta--episode").remove(),s.css("position","relative");var c=(i.name||"").trim()||"Эпизод "+r,d=function(e){if(!e)return"";try{var n=Lampa.Utils.parseTime(e).full||"";if(!(n=String(n).trim()))return"";var t=n.split(/\s+/);return t.length>=3&&/^\d{4}$/.test(t[t.length-1])?(t.pop(),t.join(" ")):n}catch(n){return String(e)}}(a),l=$('<div class="plugin-epmeta--episode"><div class="plugin-epmeta__ep"></div><div class="plugin-epmeta__date"></div></div>');l.find(".plugin-epmeta__ep").text(c),l.find(".plugin-epmeta__date").text(d),s.append(l)}}})),!0)}}function i(e){if("function"!=typeof e)return e;if(e.__abs_url_safe)return e;function n(n,t){return"string"!=typeof(i=n)||0!==i.indexOf("http://")&&0!==i.indexOf("https://")&&0!==i.indexOf("//")?e.call(this,n,t):n;var i}return n.__abs_url_safe=!0,n.__orig=e,n}function a(e,n){if(e){var t=i(e[n]);try{Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:function(){return t},set:function(e){t=i(e)}}),t=i(e[n])}catch(i){e[n]=t}}}function r(e,n,t){if(e){var i=e[n];try{Object.defineProperty(e,n,{configurable:!0,enumerable:!0,get:function(){return i},set:function(e){i=e;try{t(e)}catch(e){}}}),i&&t(i)}catch(e){}}}function o(){var e,n,t=new Lampa.Reguest,i={},a="",r=null;function o(n){r||(r=e.find(".new-interface-info__description")),r.text(null==n?"":String(n))}function s(e){var n=e&&e.overview?String(e.overview).trim():"";o(n||Lampa.Lang.translate("full_notext"))}this.create=function(){e=$('<div class="new-interface-info">\n          <div class="new-interface-info__body">\n            <div class="new-interface-info__head"></div>\n            <div class="new-interface-info__title"></div>\n            <div class="new-interface-info__details"></div>\n            <div class="new-interface-info__description"></div>\n          </div>\n        </div>'),r=e.find(".new-interface-info__description")},this.update=function(n){n=n||{},e.find(".new-interface-info__head,.new-interface-info__details").text("---"),e.find(".new-interface-info__title").text(n.title||n.name||"");var t=(n.overview||"").trim();o(t||Lampa.Lang.translate("loading")),n.backdrop_path&&Lampa.Background.change(Lampa.Api.img(n.backdrop_path,"w200")),n.id&&this.load(n)},this.draw=function(n){var t=((n.release_date||n.first_air_date||"0000")+"").slice(0,4),i=parseFloat((n.vote_average||0)+"").toFixed(1),a=[],r=[],o=Lampa.Api.sources.tmdb.parseCountries(n),s=Lampa.Api.sources.tmdb.parsePG(n);"0000"!==t&&a.push("<span>"+t+"</span>"),o.length>0&&a.push(o.join(", ")),i>0&&r.push('<div class="full-start__rate"><div>'+i+"</div><div>TMDB</div></div>"),n.genres&&n.genres.length>0&&r.push(n.genres.map((function(e){return Lampa.Utils.capitalizeFirstLetter(e.name)})).join(" | ")),n.runtime&&r.push(Lampa.Utils.secondsToTime(60*n.runtime,!0)),s&&r.push('<span class="full-start__pg" style="font-size: 0.9em;">'+s+"</span>"),e.find(".new-interface-info__head").empty().append(a.join(", ")),e.find(".new-interface-info__details").html(r.join('<span class="new-interface-info__split">&#9679;</span>'))},this.load=function(e){var r=this;if(clearTimeout(n),e&&e.id){var o=Lampa.TMDB.api((e.name?"tv":"movie")+"/"+e.id+"?api_key="+Lampa.TMDB.key()+"&append_to_response=content_ratings,release_dates&language="+Lampa.Storage.get("language"));if(a=o,i[o])return s(i[o]),this.draw(i[o]);n=setTimeout((function(){t.clear(),t.timeout(5e3);var e=o;t.silent(e,(function(n){i[e]=n||{},a===e&&(s(n),r.draw(n))}))}),250)}},this.empty=function(){},this.render=function(){return e},this.destroy=function(){e&&e.remove(),i={},e=null,r=null}}function s(i){var a,r,s,c=new Lampa.Reguest,d=new Lampa.Scroll({mask:!0,over:!0,scroll_by_item:!0}),l=[],p=$('<div class="new-interface"><img class="full-start__background"><div class="full-start__overlay"></div></div>'),f=0,u=Lampa.Manifest.app_digital>=166,m="view"==Lampa.Storage.field("card_views_type")||"mouse"==Lampa.Storage.field("navigation_type"),h=p.find(".full-start__background"),_="";this.emit={},this.use=function(e){for(var n in e=e||{})this.emit[n]=e[n];if("function"==typeof this.emit.onNext){var t=this;this.next=function(e,n){return t.emit.onNext.call(t,e,n)}}return this},this.create=function(){this.emit&&"function"==typeof this.emit.onCreate&&this.emit.onCreate.call(this)},this.empty=function(){var e;"tmdb"==i.source&&(e=$('<div class="empty__footer"><div class="simple-button selector">'+Lampa.Lang.translate("change_source_on_cub")+"</div></div>")).find(".selector").on("hover:enter",(function(){Lampa.Storage.set("source","cub"),Lampa.Activity.replace({source:"cub"})}));var n=new Lampa.Empty;p.append(n.render(e)),this.start=n.start,this.activity.loader(!1),this.activity.toggle()},this.loadNext=function(){var e=this;this.next&&!this.next_wait&&l.length&&(this.next_wait=!0,this.next((function(n){e.next_wait=!1,n.forEach(e.append.bind(e)),l[f+1]&&Lampa.Layer.visible(l[f+1].render(!0))}),(function(){e.next_wait=!1})))},this.build=function(e){var n=this;r=e,(a=new o(i)).create(),d.minus(a.render()),e.slice(0,m?e.length:2).forEach(this.append.bind(this)),p.append(a.render()),p.append(d.render()),u&&(Lampa.Layer.update(p),Lampa.Layer.visible(d.render(!0)),d.onEnd=this.loadNext.bind(this),d.onWheel=function(e){Lampa.Controller.own(n)||n.start(),e>0?n.down():f>0&&n.up()}),this.activity.loader(!1),this.activity.toggle()},this.background=function(e){var n=e&&e.card?e.card:e;if(n&&n.backdrop_path){var t=Lampa.Api.img(n.backdrop_path,"w1280");clearTimeout(s),t!==_&&(s=setTimeout((function(){h.removeClass("loaded"),h[0].onload=function(){h.addClass("loaded")},h[0].onerror=function(){h.removeClass("loaded")},_=t,setTimeout((function(){h[0].src=_}),250)}),650))}},this.append=function(r){var o=this;if(!r.ready){r.ready=!0;var s=function(e){if(!e||!Array.isArray(e.results)||!e.results.length)return!1;var n=e.results[0];return!(!n||!(n.episode||null!=n.season_number&&null!=n.episode_number&&n.air_date))}(r);s&&Array.isArray(r.results)&&r.results.forEach(e);var c=function(e){return!!e&&"shots"===String(e.title||e.name||"").toLowerCase()}(r);c&&Array.isArray(r.results)&&r.results.forEach(n);var p=new Lampa.InteractionLine(r,{url:r.url,card_small:!0,cardClass:r.cardClass,genres:i.genres,object:i,card_wide:!0,nomore:r.nomore});if(p&&"function"!=typeof p.use&&(p.use=function(e){for(var n in e=e||{},this._emit=this._emit||{},e)this._emit[n]=e[n];return"function"==typeof e.onMore&&(this.onMore=e.onMore),"function"==typeof e.onInstance&&(this.onInstance=e.onInstance),void 0!==e.module&&(this.module=e.module),this}),this.emit&&"function"==typeof this.emit.onInstance)try{this.emit.onInstance.call(this,p,r)}catch(e){}p.create(),p.onDown=this.down.bind(this),p.onUp=this.up.bind(this),p.onBack=this.back.bind(this),p.onToggle=function(){f=l.indexOf(p)};var u=p.onFocus,m=p.onHover;p.onFocus=function(e){"function"==typeof u&&u(e);var n=e&&e.card?e.card:e;a.update(n||{}),o.background(e||n||{})},p.onHover=function(e){"function"==typeof m&&m(e);var n=e&&e.card?e.card:e;a.update(n||{}),o.background(e||n||{})},a&&"function"==typeof a.empty&&(p.onFocusMore=a.empty.bind(a));var h=p.render();d.append(h),l.push(p),s&&t(h,r.results)}},this.back=function(){Lampa.Activity.backward()},this.down=function(){f++,f=Math.min(f,l.length-1),m||r.slice(0,f+2).forEach(this.append.bind(this)),l[f].toggle(),d.update(l[f].render())},this.up=function(){--f<0?(f=0,Lampa.Controller.toggle("head")):(l[f].toggle(),d.update(l[f].render()))},this.start=function(){var e=this;Lampa.Controller.add("content",{link:this,toggle:function(){if(e.activity.canRefresh())return!1;l.length&&l[f].toggle()},update:function(){},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:this.back}),Lampa.Controller.toggle("content")},this.refresh=function(){this.activity.loader(!0),this.activity.need_refresh=!0},this.pause=function(){},this.stop=function(){},this.render=function(){return p},this.destroy=function(){c.clear(),Lampa.Arrays.destroy(l),d.destroy(),a&&a.destroy(),p.remove(),l=null,c=null,r=null}}window.plugin_interface_ready||function(){if(window.plugin_interface_ready=!0,a(Lampa.Api,"img"),a(Lampa.TMDB,"image"),a(Lampa.TMDB,"img"),r(Lampa,"TMDB",(function(e){a(e,"image"),a(e,"img")})),r(Lampa,"Api",(function(e){a(e,"img")})),Lampa.Utils&&"function"==typeof Lampa.Utils.createInstance){var e=Lampa.Utils.createInstance;Lampa.Utils.createInstance=function(n,t,i,a){return i=i||{},function(e){return!(!e||"object"!=typeof e||"tmdb"!==e.source&&"cub"!==e.source||"main"!==e.component&&"category"!==e.component||window.innerWidth<767||Lampa.Manifest.app_digital<153)}(t=t||{})&&(i=Object.assign({},i,{createInstance:function(){return new s(t)}}),a=!0),e.call(this,n,t,i,a)}}else{var n=Lampa.InteractionMain,t=s;Lampa.InteractionMain=function(e){var i=t;return"tmdb"!=e.source&&"cub"!=e.source&&(i=n),window.innerWidth<767&&(i=n),Lampa.Manifest.app_digital<153&&(i=n),new i(e)}}Lampa.Template.add("new_interface_style",'\n      <style>\n        .new-interface .card--small.card--wide { width: 18.3em; }\n\n        .new-interface-info { position: relative; padding: 1.5em; height: 24em; }\n        .new-interface-info__body { width: 80%; padding-top: 1.1em; }\n        .new-interface-info__head { color: rgba(255,255,255,0.6); margin-bottom: 1em; font-size: 1.3em; min-height: 1em; }\n        .new-interface-info__head span { color: #fff; }\n\n        .new-interface-info__title {\n          font-size: 4em; font-weight: 600; margin-bottom: 0.3em; overflow: hidden;\n          -o-text-overflow: "."; text-overflow: "."; display: -webkit-box;\n          -webkit-line-clamp: 1; line-clamp: 1; -webkit-box-orient: vertical;\n          margin-left: -0.03em; line-height: 1.3;\n        }\n\n        .new-interface-info__details {\n          margin-bottom: 1.6em; display: flex; align-items: center; flex-wrap: wrap;\n          min-height: 1.9em; font-size: 1.1em;\n        }\n\n        .new-interface-info__split { margin: 0 1em; font-size: 0.7em; }\n\n        .new-interface-info__description {\n          font-size: 1.2em; font-weight: 300; line-height: 1.5; overflow: hidden;\n          -o-text-overflow: "."; text-overflow: "."; display: -webkit-box;\n          -webkit-line-clamp: 4; line-clamp: 4; -webkit-box-orient: vertical;\n          width: 70%;\n        }\n\n        .new-interface .card-more__box { padding-bottom: 95%; }\n        .new-interface .full-start__background { height: calc(100vh + 6em); top: -6em; }\n\n        .new-interface .full-start__overlay {\n          position: absolute;\n          width: 100%;\n          height: calc(100vh + 6em);\n          background: #0006; top: -6em;\n\n          width: 90vw;\n          background:\n            linear-gradient(to right,\n              rgba(0, 0, 0, 0.792) 0%,\n              rgba(0, 0, 0, 0.504) 50%,\n              rgba(0, 0, 0, 0.264) 70%,\n              rgba(0, 0, 0, 0.12) 80%,\n              rgba(0, 0, 0, 0) 100%\n            );\n        }\n\n        .new-interface .full-start__rate { font-size: 1.3em; margin-right: 0; }\n        .new-interface .card__promo { display: none; }\n        .new-interface .card.card--wide + .card-more .card-more__box { padding-bottom: 95%; }\n        .new-interface .card.card--wide .card-watched { display: none !important; }\n\n        /* Episode overlay: only episode name + day/month */\n        .new-interface .plugin-epmeta--episode{\n          position:absolute;\n          left:0;\n          right:0;\n          bottom:0;\n          padding:0.6em 0.75em;\n          background: linear-gradient(to top, rgba(0,0,0,.72), rgba(0,0,0,0));\n        }\n        .new-interface .plugin-epmeta--episode .plugin-epmeta__ep{\n          font-size: 1.05em;\n          font-weight: 700;\n          line-height: 1.15;\n          margin-bottom: 0.15em;\n        }\n        .new-interface .plugin-epmeta--episode .plugin-epmeta__date{\n          font-size: 0.95em;\n          line-height: 1.15;\n          opacity: 0.9;\n        }\n\n        body.light--version .new-interface-info__body { width: 69%; padding-top: 1.5em; }\n        body.light--version .new-interface-info { height: 25.3em; }\n\n        body.advanced--animation:not(.no--animation) .new-interface .card--small.card--wide.focus .card__view{\n          animation: animation-card-focus 0.2s\n        }\n        body.advanced--animation:not(.no--animation) .new-interface .card--small.card--wide.animate-trigger-enter .card__view{\n          animation: animation-trigger-enter 0.2s forwards\n        }\n      </style>\n      '),$("body").append(Lampa.Template.get("new_interface_style",{},!0))}()}();