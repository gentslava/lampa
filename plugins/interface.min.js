!function(){"use strict";function e(e){if(e){var t=e.episode||e,n=e.card||e.episode&&e.episode.card||null,a=t.still_path||null;e.backdrop_path||(e.backdrop_path=a||n&&(n.backdrop_path||n.poster_path)||e.poster_path||null),e.poster_path||(e.poster_path=a||n&&(n.poster_path||n.backdrop_path)||e.backdrop_path||null),null!=e.id&&null==e.episode_id&&(e.episode_id=e.id),n&&null!=n.id&&(e.id=n.id),n&&(!e.name&&n.name&&(e.name=n.name),!e.title&&n.title&&(e.title=n.title),!e.overview&&n.overview&&(e.overview=n.overview),!e.source&&n.source&&(e.source=n.source))}}function t(e){if(e){!e.backdrop_path&&e.screen&&(e.backdrop_path=e.screen),!e.poster_path&&e.screen&&(e.poster_path=e.screen),!e.poster_path&&e.card_poster&&(e.poster_path=e.card_poster),!e.title&&e.card_title&&(e.title=e.card_title);var t=e.card_id?parseInt(e.card_id,10):null;e.card||(e.card={}),t&&(e.card.id=t),e.card.source=e.card.source||"tmdb",e.card.type=(e.card.type||e.card_type||"movie").toString().toLowerCase(),"tv"!==e.card.type&&"movie"!==e.card.type&&(e.card.type="movie"),!e.card.poster_path&&e.card_poster&&(e.card.poster_path=e.card_poster),!e.card.backdrop_path&&e.backdrop_path&&(e.card.backdrop_path=e.backdrop_path),null!=e.id&&null==e.shot_id&&(e.shot_id=e.id),t&&(e.id=t),"movie"===e.card.type?(e.card.title=e.card.title||e.card_title||e.title||"",e.card.name&&delete e.card.name,e.name&&delete e.name,!e.card.release_date&&e.card_year&&(e.card.release_date=e.card_year+"-01-01"),e.card.first_air_date&&delete e.card.first_air_date):(e.card.name=e.card.name||e.card_title||e.name||e.title||"",e.card.title&&delete e.card.title,!e.name&&e.card_title&&(e.name=e.card_title),!e.card.first_air_date&&e.card_year&&(e.card.first_air_date=e.card_year+"-01-01"),e.card.release_date&&delete e.card.release_date)}}function n(e,t){var n=e&&e.jquery?e[0]:e;if(n&&t&&t.length&&!i()){var a=new MutationObserver((function(){i()&&a.disconnect()}));a.observe(n,{childList:!0,subtree:!0})}function i(){var e=$(n).find(".card");return!!e.length&&(e.each((function(e){var n=t[e];if(n){var a=n.episode||n,i=a.air_date,r=a.episode_number;if(i&&null!=r){var o=$(this),c=o.find(".card__view");c.length||(c=o),c.find(".plugin-epmeta--episode").remove(),c.css("position","relative");var s=(a.name||"").trim()||"Эпизод "+r,d=function(e){if(!e)return"";try{var t=Lampa.Utils.parseTime(e).full||"";if(!(t=String(t).trim()))return"";var n=t.split(/\s+/);return n.length>=3&&/^\d{4}$/.test(n[n.length-1])?(n.pop(),n.join(" ")):t}catch(t){return String(e)}}(i),l=$('<div class="plugin-epmeta--episode"><div class="plugin-epmeta__ep"></div><div class="plugin-epmeta__date"></div></div>');l.find(".plugin-epmeta__ep").text(s),l.find(".plugin-epmeta__date").text(d),c.append(l)}}})),!0)}}function a(e){if("function"!=typeof e)return e;if(e.__abs_url_safe)return e;function t(t,n){return"string"!=typeof(a=t)||0!==a.indexOf("http://")&&0!==a.indexOf("https://")&&0!==a.indexOf("//")?e.call(this,t,n):t;var a}return t.__abs_url_safe=!0,t.__orig=e,t}function i(e,t){if(e){var n=a(e[t]);try{Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return n},set:function(e){n=a(e)}}),n=a(e[t])}catch(a){e[t]=n}}}function r(e,t,n){if(e){var a=e[t];try{Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return a},set:function(e){a=e;try{n(e)}catch(e){}}}),a&&n(a)}catch(e){}}}function o(){var e,t,n=new Lampa.Reguest,a={},i="",r=null;function o(t){r||(r=e.find(".new-interface-info__description")),r.text(null==t?"":String(t))}function c(e){var t=e&&e.overview?String(e.overview).trim():"";o(t||Lampa.Lang.translate("full_notext"))}this.create=function(){e=$('<div class="new-interface-info">\n          <div class="new-interface-info__body">\n            <div class="new-interface-info__head"></div>\n            <div class="new-interface-info__title"></div>\n            <div class="new-interface-info__details"></div>\n            <div class="new-interface-info__description"></div>\n          </div>\n        </div>'),r=e.find(".new-interface-info__description")},this.update=function(t){t=t||{},e.find(".new-interface-info__head,.new-interface-info__details").text("---"),e.find(".new-interface-info__title").text(t.title||t.name||"");var n=(t.overview||"").trim();o(n||Lampa.Lang.translate("loading")),t.backdrop_path&&Lampa.Background.change(Lampa.Api.img(t.backdrop_path,"w200")),t.id&&this.load(t)},this.draw=function(t){var n=((t.release_date||t.first_air_date||"0000")+"").slice(0,4),a=parseFloat((t.vote_average||0)+"").toFixed(1),i=[],r=[],o=Lampa.Api.sources.tmdb.parseCountries(t),c=Lampa.Api.sources.tmdb.parsePG(t);"0000"!==n&&i.push("<span>"+n+"</span>"),o.length>0&&i.push(o.join(", ")),a>0&&r.push('<div class="full-start__rate"><div>'+a+"</div><div>TMDB</div></div>"),t.genres&&t.genres.length>0&&r.push(t.genres.map((function(e){return Lampa.Utils.capitalizeFirstLetter(e.name)})).join(" | ")),t.runtime&&r.push(Lampa.Utils.secondsToTime(60*t.runtime,!0)),c&&r.push('<span class="full-start__pg" style="font-size: 0.9em;">'+c+"</span>"),e.find(".new-interface-info__head").empty().append(i.join(", ")),e.find(".new-interface-info__details").html(r.join('<span class="new-interface-info__split">&#9679;</span>'))},this.load=function(e){var r=this;if(clearTimeout(t),e&&e.id){var o=Lampa.TMDB.api((e.name?"tv":"movie")+"/"+e.id+"?api_key="+Lampa.TMDB.key()+"&append_to_response=content_ratings,release_dates&language="+Lampa.Storage.get("language"));if(i=o,a[o])return c(a[o]),this.draw(a[o]);t=setTimeout((function(){n.clear(),n.timeout(5e3);var e=o;n.silent(e,(function(t){a[e]=t||{},i===e&&(c(t),r.draw(t))}))}),250)}},this.empty=function(){},this.render=function(){return e},this.destroy=function(){e&&e.remove(),a={},e=null,r=null}}function c(a){var i,r,c,s=new Lampa.Reguest,d=new Lampa.Scroll({mask:!0,over:!0,scroll_by_item:!0}),l=[],p=$('<div class="new-interface"><img class="full-start__background"><div class="full-start__overlay"></div></div>'),f=0,u=Lampa.Manifest.app_digital>=166,m="view"==Lampa.Storage.field("card_views_type")||"mouse"==Lampa.Storage.field("navigation_type"),h=p.find(".full-start__background"),_="";this.emit={},this.use=function(e){for(var t in e=e||{})this.emit[t]=e[t];if("function"==typeof this.emit.onNext){var n=this;this.next=function(e,t){return n.emit.onNext.call(n,e,t)}}return this},this.create=function(){this.emit&&"function"==typeof this.emit.onCreate&&this.emit.onCreate.call(this)},this.empty=function(){var e;"tmdb"==a.source&&(e=$('<div class="empty__footer"><div class="simple-button selector">'+Lampa.Lang.translate("change_source_on_cub")+"</div></div>")).find(".selector").on("hover:enter",(function(){Lampa.Storage.set("source","cub"),Lampa.Activity.replace({source:"cub"})}));var t=new Lampa.Empty;p.append(t.render(e)),this.start=t.start,this.activity.loader(!1),this.activity.toggle()},this.loadNext=function(){var e=this;this.next&&!this.next_wait&&l.length&&(this.next_wait=!0,this.next((function(t){e.next_wait=!1,t.forEach(e.append.bind(e)),l[f+1]&&Lampa.Layer.visible(l[f+1].render(!0))}),(function(){e.next_wait=!1})))},this.build=function(e){var t=this;r=e,(i=new o(a)).create(),d.minus(i.render()),e.slice(0,m?e.length:2).forEach(this.append.bind(this)),p.append(i.render()),p.append(d.render()),u&&(Lampa.Layer.update(p),Lampa.Layer.visible(d.render(!0)),d.onEnd=this.loadNext.bind(this),d.onWheel=function(e){Lampa.Controller.own(t)||t.start(),e>0?t.down():f>0&&t.up()}),this.activity.loader(!1),this.activity.toggle()},this.background=function(e){var t=e&&e.card?e.card:e;if(t&&t.backdrop_path){var n=Lampa.Api.img(t.backdrop_path,"w1280");clearTimeout(c),n!==_&&(c=setTimeout((function(){h.removeClass("loaded"),h[0].onload=function(){h.addClass("loaded")},h[0].onerror=function(){h.removeClass("loaded")},_=n,setTimeout((function(){h[0].src=_}),250)}),650))}},this.append=function(r){var o=this;if(!r.ready){r.ready=!0;var c=function(e){if(!e||!Array.isArray(e.results)||!e.results.length)return!1;var t=e.results[0];return!(!t||!(t.episode||null!=t.season_number&&null!=t.episode_number&&t.air_date))}(r);c&&Array.isArray(r.results)&&r.results.forEach(e);var s=function(e){return!!e&&"shots"===String(e.title||e.name||"").toLowerCase()}(r);s&&Array.isArray(r.results)&&r.results.forEach(t);var p=new Lampa.InteractionLine(r,{url:r.url,card_small:!0,cardClass:r.cardClass,genres:a.genres,object:a,card_wide:!0,nomore:r.nomore});if(p&&"function"!=typeof p.use&&(p.use=function(e){for(var t in e=e||{},this._emit=this._emit||{},e)this._emit[t]=e[t];return"function"==typeof e.onMore&&(this.onMore=e.onMore),"function"==typeof e.onInstance&&(this.onInstance=e.onInstance),void 0!==e.module&&(this.module=e.module),this}),this.emit&&"function"==typeof this.emit.onInstance)try{this.emit.onInstance.call(this,p,r)}catch(e){}p.create(),p.onDown=this.down.bind(this),p.onUp=this.up.bind(this),p.onBack=this.back.bind(this),p.onToggle=function(){f=l.indexOf(p)};var u=p.onFocus,m=p.onHover;p.onFocus=function(e){"function"==typeof u&&u(e);var t=e&&e.card?e.card:e;i.update(t||{}),o.background(e||t||{})},p.onHover=function(e){"function"==typeof m&&m(e);var t=e&&e.card?e.card:e;i.update(t||{}),o.background(e||t||{})},i&&"function"==typeof i.empty&&(p.onFocusMore=i.empty.bind(i));var h=p.render();d.append(h),l.push(p),c&&n(h,r.results)}},this.back=function(){Lampa.Activity.backward()},this.down=function(){f++,f=Math.min(f,l.length-1),m||r.slice(0,f+2).forEach(this.append.bind(this)),l[f].toggle(),d.update(l[f].render())},this.up=function(){--f<0?(f=0,Lampa.Controller.toggle("head")):(l[f].toggle(),d.update(l[f].render()))},this.start=function(){var e=this;Lampa.Controller.add("content",{link:this,toggle:function(){if(e.activity.canRefresh())return!1;l.length&&l[f].toggle()},update:function(){},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:this.back}),Lampa.Controller.toggle("content")},this.refresh=function(){this.activity.loader(!0),this.activity.need_refresh=!0},this.pause=function(){},this.stop=function(){},this.render=function(){return p},this.destroy=function(){s.clear(),Lampa.Arrays.destroy(l),d.destroy(),i&&i.destroy(),p.remove(),l=null,s=null,r=null}}window.plugin_interface_ready||function(){if(window.plugin_interface_ready=!0,i(Lampa.Api,"img"),i(Lampa.TMDB,"image"),i(Lampa.TMDB,"img"),r(Lampa,"TMDB",(function(e){i(e,"image"),i(e,"img")})),r(Lampa,"Api",(function(e){i(e,"img")})),Lampa.Utils&&"function"==typeof Lampa.Utils.createInstance){var e=Lampa.Utils.createInstance;Lampa.Utils.createInstance=function(t,n,a,i){return a=a||{},function(e){return!(!e||"object"!=typeof e||"tmdb"!==e.source&&"cub"!==e.source||"main"!==e.component&&"category"!==e.component||window.innerWidth<767||Lampa.Manifest.app_digital<153)}(n=n||{})&&(a=Object.assign({},a,{createInstance:function(){return new c(n)}}),i=!0),e.call(this,t,n,a,i)}}else{var t=Lampa.InteractionMain,n=c;Lampa.InteractionMain=function(e){var a=n;return"tmdb"!=e.source&&"cub"!=e.source&&(a=t),window.innerWidth<767&&(a=t),Lampa.Manifest.app_digital<153&&(a=t),new a(e)}}Lampa.Template.add("new_interface_style",'\n      <style>\n        .new-interface .card--small.card--wide { width: 18.3em; }\n\n        .new-interface-info { position: relative; padding: 1.5em; height: 24em; }\n        .new-interface-info__body { width: 80%; padding-top: 1.1em; }\n        .new-interface-info__head { color: rgba(255,255,255,0.6); margin-bottom: 1em; font-size: 1.3em; min-height: 1em; }\n        .new-interface-info__head span { color: #fff; }\n\n        .new-interface-info__title {\n          font-size: 4em; font-weight: 600; margin-bottom: 0.3em; overflow: hidden;\n          -o-text-overflow: "."; text-overflow: "."; display: -webkit-box;\n          -webkit-line-clamp: 1; line-clamp: 1; -webkit-box-orient: vertical;\n          margin-left: -0.03em; line-height: 1.3;\n        }\n\n        .new-interface-info__details {\n          margin-bottom: 1.6em; display: flex; align-items: center; flex-wrap: wrap;\n          min-height: 1.9em; font-size: 1.1em;\n        }\n\n        .new-interface-info__split { margin: 0 1em; font-size: 0.7em; }\n\n        .new-interface-info__description {\n          font-size: 1.2em; font-weight: 300; line-height: 1.5; overflow: hidden;\n          -o-text-overflow: "."; text-overflow: "."; display: -webkit-box;\n          -webkit-line-clamp: 4; line-clamp: 4; -webkit-box-orient: vertical;\n          width: 70%;\n        }\n\n        .new-interface .card-more__box { padding-bottom: 95%; }\n        .new-interface .full-start__background { height: calc(100vh + 6em); top: -6em; }\n\n        .new-interface .full-start__overlay {\n          position: absolute;\n          width: 100%;\n          height: calc(100vh + 6em);\n          background: #0006; top: -6em;\n\n          width: 90vw;\n          background:\n            linear-gradient(to right,\n              rgba(0, 0, 0, 0.792) 0%,\n              rgba(0, 0, 0, 0.504) 50%,\n              rgba(0, 0, 0, 0.264) 70%,\n              rgba(0, 0, 0, 0.12) 80%,\n              rgba(0, 0, 0, 0) 100%\n            );\n        }\n\n        .new-interface .full-start__rate { font-size: 1.3em; margin-right: 0; }\n        .new-interface .card__promo { display: none; }\n        .new-interface .card.card--wide + .card-more .card-more__box { padding-bottom: 95%; }\n        .new-interface .card.card--wide .card-watched { display: none !important; }\n\n        /* Episode overlay: only episode name + day/month */\n        .new-interface .plugin-epmeta--episode{\n          position:absolute;\n          left:0;\n          right:0;\n          bottom:0;\n          padding:0.6em 0.75em;\n          background: linear-gradient(to top, rgba(0,0,0,.72), rgba(0,0,0,0));\n        }\n        .new-interface .plugin-epmeta--episode .plugin-epmeta__ep{\n          font-size: 1.05em;\n          font-weight: 700;\n          line-height: 1.15;\n          margin-bottom: 0.15em;\n        }\n        .new-interface .plugin-epmeta--episode .plugin-epmeta__date{\n          font-size: 0.95em;\n          line-height: 1.15;\n          opacity: 0.9;\n        }\n\n        body.light--version .new-interface-info__body { width: 69%; padding-top: 1.5em; }\n        body.light--version .new-interface-info { height: 25.3em; }\n\n        body.advanced--animation:not(.no--animation) .new-interface .card--small.card--wide.focus .card__view{\n          animation: animation-card-focus 0.2s\n        }\n        body.advanced--animation:not(.no--animation) .new-interface .card--small.card--wide.animate-trigger-enter .card__view{\n          animation: animation-trigger-enter 0.2s forwards\n        }\n      </style>\n      '),$("body").append(Lampa.Template.get("new_interface_style",{},!0))}()}();