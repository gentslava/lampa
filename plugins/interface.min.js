!function(){"use strict";function e(){var e,n,t=new Lampa.Reguest,i={};this.create=function(){e=$('<div class="new-interface-info">\n        <div class="new-interface-info__body">\n        <div class="new-interface-info__head"></div>\n        <div class="new-interface-info__title"></div>\n        <div class="new-interface-info__details"></div>\n        <div class="new-interface-info__description"></div>\n        </div>\n        </div>')},this.update=function(n){e.find(".new-interface-info__head,.new-interface-info__details").text("---"),e.find(".new-interface-info__title").text(n.title),e.find(".new-interface-info__description").text(n.overview||Lampa.Lang.translate("full_notext")),Lampa.Background.change(Lampa.Api.img(n.backdrop_path,"w200")),this.load(n)},this.draw=function(n){var t=((n.release_date||n.first_air_date||"0000")+"").slice(0,4),i=parseFloat((n.vote_average||0)+"").toFixed(1),a=[],o=[],r=Lampa.Api.sources.tmdb.parseCountries(n),s=Lampa.Api.sources.tmdb.parsePG(n);"0000"!==t&&a.push("<span>"+t+"</span>"),r.length>0&&a.push(r.join(", ")),i>0&&o.push('<div class="full-start__rate"><div>'+i+"</div><div>TMDB</div></div>"),n.genres&&n.genres.length>0&&o.push(n.genres.map((function(e){return Lampa.Utils.capitalizeFirstLetter(e.name)})).join(" | ")),n.runtime&&o.push(Lampa.Utils.secondsToTime(60*n.runtime,!0)),s&&o.push('<span class="full-start__pg" style="font-size: 0.9em;">'+s+"</span>"),e.find(".new-interface-info__head").empty().append(a.join(", ")),e.find(".new-interface-info__details").html(o.join('<span class="new-interface-info__split">&#9679;</span>'))},this.load=function(e){var a=this;clearTimeout(n);var o=Lampa.TMDB.api((e.name?"tv":"movie")+"/"+e.id+"?api_key="+Lampa.TMDB.key()+"&append_to_response=content_ratings,release_dates&language="+Lampa.Storage.get("language"));if(i[o])return this.draw(i[o]);n=setTimeout((function(){t.clear(),t.timeout(5e3),t.silent(o,(function(e){i[o]=e,a.draw(e)}))}),300)},this.render=function(){return e},this.empty=function(){},this.destroy=function(){e.remove(),i={},e=null}}function n(n){var t,i,a,o=new Lampa.Reguest,r=new Lampa.Scroll({mask:!0,over:!0,scroll_by_item:!0}),s=[],c=$('<div class="new-interface"><img class="full-start__background"><div class="full-start__overlay"></div></div>'),d=0,l=Lampa.Manifest.app_digital>=166,f="view"==Lampa.Storage.field("card_views_type")||"mouse"==Lampa.Storage.field("navigation_type"),p=c.find(".full-start__background"),m="";this.emit={},this.use=function(e){if("function"==typeof(e=e||{}).onCreate&&(this.emit.onCreate=e.onCreate),"function"==typeof e.onNext&&(this.emit.onNext=e.onNext),this.emit.onNext){var n=this;this.next=function(e,t){return n.emit.onNext.call(n,e,t)}}return this},this.create=function(){this.emit.onCreate&&this.emit.onCreate.call(this)},this.empty=function(){var e;"tmdb"==n.source&&(e=$('<div class="empty__footer"><div class="simple-button selector">'+Lampa.Lang.translate("change_source_on_cub")+"</div></div>")).find(".selector").on("hover:enter",(function(){Lampa.Storage.set("source","cub"),Lampa.Activity.replace({source:"cub"})}));var t=new Lampa.Empty;c.append(t.render(e)),this.start=t.start,this.activity.loader(!1),this.activity.toggle()},this.loadNext=function(){var e=this;this.next&&!this.next_wait&&s.length&&(this.next_wait=!0,this.next((function(n){e.next_wait=!1,n.forEach(e.append.bind(e)),s[d+1]&&Lampa.Layer.visible(s[d+1].render(!0))}),(function(){e.next_wait=!1})))},this.push=function(){},this.build=function(a){var o=this;i=a,(t=new e(n)).create(),r.minus(t.render()),a.slice(0,f?a.length:2).forEach(this.append.bind(this)),c.append(t.render()),c.append(r.render()),l&&(Lampa.Layer.update(c),Lampa.Layer.visible(r.render(!0)),r.onEnd=this.loadNext.bind(this),r.onWheel=function(e){Lampa.Controller.own(o)||o.start(),e>0?o.down():d>0&&o.up()}),this.activity.loader(!1),this.activity.toggle()},this.background=function(e){var n=Lampa.Api.img(e.backdrop_path,"w1280");clearTimeout(a),n!=m&&(a=setTimeout((function(){p.removeClass("loaded"),p[0].onload=function(){p.addClass("loaded")},p[0].onerror=function(){p.removeClass("loaded")},m=n,setTimeout((function(){p[0].src=m}),300)}),1e3))},this.append=function(e){var i=this;if(!e.ready){e.ready=!0;var a=new Lampa.InteractionLine(e,{url:e.url,card_small:!0,cardClass:e.cardClass,genres:n.genres,object:n,card_wide:!0,nomore:e.nomore});a.create(),a.onDown=this.down.bind(this),a.onUp=this.up.bind(this),a.onBack=this.back.bind(this),a.onToggle=function(){d=s.indexOf(a)},this.onMore&&(a.onMore=this.onMore.bind(this)),a.onFocus=function(e){t.update(e),i.background(e)},a.onHover=function(e){t.update(e),i.background(e)},a.onFocusMore=t.empty.bind(t),r.append(a.render()),s.push(a)}},this.back=function(){Lampa.Activity.backward()},this.down=function(){d++,d=Math.min(d,s.length-1),f||i.slice(0,d+2).forEach(this.append.bind(this)),s[d].toggle(),r.update(s[d].render())},this.up=function(){--d<0?(d=0,Lampa.Controller.toggle("head")):(s[d].toggle(),r.update(s[d].render()))},this.start=function(){var e=this;Lampa.Controller.add("content",{link:this,toggle:function(){if(e.activity.canRefresh())return!1;s.length&&s[d].toggle()},update:function(){},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:this.back}),Lampa.Controller.toggle("content")},this.refresh=function(){this.activity.loader(!0),this.activity.need_refresh=!0},this.pause=function(){},this.stop=function(){},this.render=function(){return c},this.destroy=function(){o.clear(),Lampa.Arrays.destroy(s),r.destroy(),t&&t.destroy(),c.remove(),s=null,o=null,i=null}}window.plugin_interface_ready||function(){if(window.plugin_interface_ready=!0,Lampa.Utils&&"function"==typeof Lampa.Utils.createInstance){var e=Lampa.Utils.createInstance;Lampa.Utils.createInstance=function(t,i,a,o){a=a||{};var r="tmdb"===(i=i||{}).source||"cub"===i.source,s=window.innerWidth>=767,c=Lampa.Manifest.app_digital>=153;return"main"===i.component&&r&&s&&c&&(a=Object.assign({},a,{createInstance:function(e){return new n(e)}}),o=!0),e.call(this,t,i,a,o)}}else{var t=Lampa.InteractionMain,i=n;Lampa.InteractionMain=function(e){var n=i;return"tmdb"!=e.source&&"cub"!=e.source&&(n=t),window.innerWidth<767&&(n=t),Lampa.Manifest.app_digital<153&&(n=t),new n(e)}}Lampa.Template.add("new_interface_style",'\n      <style>\n      .new-interface .card--small.card--wide { width: 18.3em; }\n      .new-interface-info { position: relative; padding: 1.5em; height: 24em; }\n      .new-interface-info__body { width: 80%; padding-top: 1.1em; }\n      .new-interface-info__head { color: rgba(255,255,255,0.6); margin-bottom: 1em; font-size: 1.3em; min-height: 1em; }\n      .new-interface-info__head span { color: #fff; }\n      .new-interface-info__title {\n        font-size: 4em; font-weight: 600; margin-bottom: 0.3em; overflow: hidden;\n        -o-text-overflow: "."; text-overflow: "."; display: -webkit-box;\n        -webkit-line-clamp: 1; line-clamp: 1; -webkit-box-orient: vertical;\n        margin-left: -0.03em; line-height: 1.3;\n      }\n      .new-interface-info__details {\n        margin-bottom: 1.6em; display: flex; align-items: center; flex-wrap: wrap;\n        min-height: 1.9em; font-size: 1.1em;\n      }\n      .new-interface-info__split { margin: 0 1em; font-size: 0.7em; }\n      .new-interface-info__description {\n        font-size: 1.2em; font-weight: 300; line-height: 1.5; overflow: hidden;\n        -o-text-overflow: "."; text-overflow: "."; display: -webkit-box;\n        -webkit-line-clamp: 4; line-clamp: 4; -webkit-box-orient: vertical;\n        width: 70%;\n      }\n      .new-interface .card-more__box { padding-bottom: 95%; }\n      .new-interface .full-start__background { height: calc(100% + 6em); top: -6em; }\n      .new-interface .full-start__overlay { position: absolute; width: 100%; height: calc(100% + 6em); background: #0006; top: -6em; }\n      .new-interface .full-start__rate { font-size: 1.3em; margin-right: 0; }\n      .new-interface .card__promo { display: none; }\n      .new-interface .card.card--wide+.card-more .card-more__box { padding-bottom: 95%; }\n      .new-interface .card.card--wide .card-watched { display: none !important; }\n      body.light--version .new-interface-info__body { width: 69%; padding-top: 1.5em; }\n      body.light--version .new-interface-info { height: 25.3em; }\n      body.advanced--animation:not(.no--animation) .new-interface .card--small.card--wide.focus .card__view{\n        animation: animation-card-focus 0.2s\n      }\n      body.advanced--animation:not(.no--animation) .new-interface .card--small.card--wide.animate-trigger-enter .card__view{\n        animation: animation-trigger-enter 0.2s forwards\n      }\n      </style>\n      '),$("body").append(Lampa.Template.get("new_interface_style",{},!0))}()}();