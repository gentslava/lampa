!function(){"use strict";function e(){var e,t,n=new Lampa.Reguest,a={};this.create=function(){e=$('<div class="new-interface-info">\n        <div class="new-interface-info__body">\n        <div class="new-interface-info__head"></div>\n        <div class="new-interface-info__title"></div>\n        <div class="new-interface-info__details"></div>\n        <div class="new-interface-info__description"></div>\n        </div>\n        </div>')},this.update=function(t){e.find(".new-interface-info__head,.new-interface-info__details").text("---"),e.find(".new-interface-info__title").text(t.title||t.name||""),e.find(".new-interface-info__description").text(t.overview||Lampa.Lang.translate("full_notext")),t.backdrop_path&&Lampa.Background.change(Lampa.Api.img(t.backdrop_path,"w200")),t.id&&this.load(t)},this.draw=function(t){var n=((t.release_date||t.first_air_date||"0000")+"").slice(0,4),a=parseFloat((t.vote_average||0)+"").toFixed(1),i=[],r=[],o=Lampa.Api.sources.tmdb.parseCountries(t),s=Lampa.Api.sources.tmdb.parsePG(t);"0000"!==n&&i.push("<span>"+n+"</span>"),o.length>0&&i.push(o.join(", ")),a>0&&r.push('<div class="full-start__rate"><div>'+a+"</div><div>TMDB</div></div>"),t.genres&&t.genres.length>0&&r.push(t.genres.map((function(e){return Lampa.Utils.capitalizeFirstLetter(e.name)})).join(" | ")),t.runtime&&r.push(Lampa.Utils.secondsToTime(60*t.runtime,!0)),s&&r.push('<span class="full-start__pg" style="font-size: 0.9em;">'+s+"</span>"),e.find(".new-interface-info__head").empty().append(i.join(", ")),e.find(".new-interface-info__details").html(r.join('<span class="new-interface-info__split">&#9679;</span>'))},this.load=function(e){var i=this;if(clearTimeout(t),e&&e.id){var r=Lampa.TMDB.api((e.name?"tv":"movie")+"/"+e.id+"?api_key="+Lampa.TMDB.key()+"&append_to_response=content_ratings,release_dates&language="+Lampa.Storage.get("language"));if(a[r])return this.draw(a[r]);t=setTimeout((function(){n.clear(),n.timeout(5e3),n.silent(r,(function(e){a[r]=e,i.draw(e)}))}),300)}},this.render=function(){return e},this.empty=function(){},this.destroy=function(){e&&e.remove(),a={},e=null}}function t(e){e&&(!e.backdrop_path&&e.screen&&(e.backdrop_path=e.screen),!e.poster_path&&e.screen&&(e.poster_path=e.screen),!e.poster_path&&e.card_poster&&(e.poster_path=e.card_poster),!e.title&&e.card_title&&(e.title=e.card_title),!e.release_date&&e.card_year&&(e.release_date=String(e.card_year)+"-01-01"))}function n(n){var a,i,r,o=new Lampa.Reguest,s=new Lampa.Scroll({mask:!0,over:!0,scroll_by_item:!0}),c=[],d=$('<div class="new-interface"><img class="full-start__background"><div class="full-start__overlay"></div></div>'),l=0,p=Lampa.Manifest.app_digital>=166,f="view"==Lampa.Storage.field("card_views_type")||"mouse"==Lampa.Storage.field("navigation_type"),u=d.find(".full-start__background"),m="";this.emit={},this.use=function(e){for(var t in e=e||{})this.emit[t]=e[t];if("function"==typeof this.emit.onNext){var n=this;this.next=function(e,t){return n.emit.onNext.call(n,e,t)}}return this},this.create=function(){this.emit&&"function"==typeof this.emit.onCreate&&this.emit.onCreate.call(this)},this.empty=function(){var e;"tmdb"==n.source&&(e=$('<div class="empty__footer"><div class="simple-button selector">'+Lampa.Lang.translate("change_source_on_cub")+"</div></div>")).find(".selector").on("hover:enter",(function(){Lampa.Storage.set("source","cub"),Lampa.Activity.replace({source:"cub"})}));var t=new Lampa.Empty;d.append(t.render(e)),this.start=t.start,this.activity.loader(!1),this.activity.toggle()},this.loadNext=function(){var e=this;this.next&&!this.next_wait&&c.length&&(this.next_wait=!0,this.next((function(t){e.next_wait=!1,t.forEach(e.append.bind(e)),c[l+1]&&Lampa.Layer.visible(c[l+1].render(!0))}),(function(){e.next_wait=!1})))},this.build=function(t){var r=this;i=t,(a=new e(n)).create(),s.minus(a.render()),t.slice(0,f?t.length:2).forEach(this.append.bind(this)),d.append(a.render()),d.append(s.render()),p&&(Lampa.Layer.update(d),Lampa.Layer.visible(s.render(!0)),s.onEnd=this.loadNext.bind(this),s.onWheel=function(e){Lampa.Controller.own(r)||r.start(),e>0?r.down():l>0&&r.up()}),this.activity.loader(!1),this.activity.toggle()},this.background=function(e){var t=e&&e.card?e.card:e;if(t&&t.backdrop_path){var n=Lampa.Api.img(t.backdrop_path,"w1280");clearTimeout(r),n!=m&&(r=setTimeout((function(){u.removeClass("loaded"),u[0].onload=function(){u.addClass("loaded")},u[0].onerror=function(){u.removeClass("loaded")},m=n,setTimeout((function(){u[0].src=m}),300)}),1e3))}},this.append=function(e){var i=this;if(!e.ready){e.ready=!0,e&&Array.isArray(e.results)&&e.results.forEach((function(e){e&&(e.still_path||e.card||e.episode)&&function(e){if(e){var t=e.still_path||e.episode&&e.episode.still_path||null,n=e.card||e.episode&&e.episode.card||null;e.backdrop_path||(e.backdrop_path=t||n&&(n.backdrop_path||n.poster_path)||e.poster_path||null),e.poster_path||(e.poster_path=t||n&&(n.poster_path||n.backdrop_path)||e.backdrop_path||null)}}(e)})),e&&("shots"===String(e.title||"").toLowerCase()||"shots"===String(e.name||"").toLowerCase())&&e.results&&Array.isArray(e.results)&&e.results.forEach(t);var r=new Lampa.InteractionLine(e,{url:e.url,card_small:!0,cardClass:e.cardClass,genres:n.genres,object:n,card_wide:!0,nomore:e.nomore});if(r&&"function"!=typeof r.use&&(r.use=function(e){for(var t in e=e||{},this._emit=this._emit||{},e)this._emit[t]=e[t];return"function"==typeof e.onMore&&(this.onMore=e.onMore),"function"==typeof e.onInstance&&(this.onInstance=e.onInstance),void 0!==e.module&&(this.module=e.module),this}),this.emit&&"function"==typeof this.emit.onInstance)try{this.emit.onInstance.call(this,r,e)}catch(e){}r.create(),r.onDown=this.down.bind(this),r.onUp=this.up.bind(this),r.onBack=this.back.bind(this),r.onToggle=function(){l=c.indexOf(r)};var o=r.onFocus,d=r.onHover;r.onFocus=function(e){"function"==typeof o&&o(e);var t=e&&e.card?e.card:e;a.update(t||{}),i.background(e||t||{})},r.onHover=function(e){"function"==typeof d&&d(e);var t=e&&e.card?e.card:e;a.update(t||{}),i.background(e||t||{})},r.onFocusMore=a.empty.bind(a),s.append(r.render()),c.push(r)}},this.back=function(){Lampa.Activity.backward()},this.down=function(){l++,l=Math.min(l,c.length-1),f||i.slice(0,l+2).forEach(this.append.bind(this)),c[l].toggle(),s.update(c[l].render())},this.up=function(){--l<0?(l=0,Lampa.Controller.toggle("head")):(c[l].toggle(),s.update(c[l].render()))},this.start=function(){var e=this;Lampa.Controller.add("content",{link:this,toggle:function(){if(e.activity.canRefresh())return!1;c.length&&c[l].toggle()},update:function(){},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:this.back}),Lampa.Controller.toggle("content")},this.refresh=function(){this.activity.loader(!0),this.activity.need_refresh=!0},this.pause=function(){},this.stop=function(){},this.render=function(){return d},this.destroy=function(){o.clear(),Lampa.Arrays.destroy(c),s.destroy(),a&&a.destroy(),d.remove(),c=null,o=null,i=null}}window.plugin_interface_ready||function(){function e(e){if("function"!=typeof e)return e;if(e.__abs_url_safe)return e;function t(t,n){if("string"==typeof t){if(0===t.indexOf("http://")||0===t.indexOf("https://"))return t;if(0===t.indexOf("//"))return location.protocol+t}return e.call(this,t,n)}return t.__abs_url_safe=!0,t.__orig=e,t}function t(t,n){if(!t)return!1;let a=e(t[n]);try{return Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get:()=>a,set(t){a=e(t)}}),a=e(t[n]),!0}catch(e){return t[n]=a,!1}}function a(e,t,n){if(!e)return;let a=e[t];try{Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:()=>a,set(e){a=e;try{n(e)}catch(e){}}}),a&&n(a)}catch(e){}}if(window.plugin_interface_ready=!0,t(Lampa.Api,"img"),t(Lampa.TMDB,"image"),t(Lampa.TMDB,"img"),a(Lampa,"TMDB",(e=>{t(e,"image"),t(e,"img")})),a(Lampa,"Api",(e=>{t(e,"img")})),Lampa.Utils&&"function"==typeof Lampa.Utils.createInstance){var i=Lampa.Utils.createInstance;Lampa.Utils.createInstance=function(e,t,a,r){return a=a||{},function(e){return!(!e||"object"!=typeof e||"tmdb"!==e.source&&"cub"!==e.source||"main"!==e.component&&"category"!==e.component||window.innerWidth<767||Lampa.Manifest.app_digital<153)}(t=t||{})&&(a=Object.assign({},a,{createInstance:function(e){return new n(e)}}),r=!0),i.call(this,e,t,a,r)}}else{var r=Lampa.InteractionMain,o=n;Lampa.InteractionMain=function(e){var t=o;return"tmdb"!=e.source&&"cub"!=e.source&&(t=r),window.innerWidth<767&&(t=r),Lampa.Manifest.app_digital<153&&(t=r),new t(e)}}Lampa.Template.add("new_interface_style",'\n      <style>\n      .new-interface .card--small.card--wide { width: 18.3em; }\n      .new-interface-info { position: relative; padding: 1.5em; height: 24em; }\n      .new-interface-info__body { width: 80%; padding-top: 1.1em; }\n      .new-interface-info__head { color: rgba(255,255,255,0.6); margin-bottom: 1em; font-size: 1.3em; min-height: 1em; }\n      .new-interface-info__head span { color: #fff; }\n      .new-interface-info__title {\n        font-size: 4em; font-weight: 600; margin-bottom: 0.3em; overflow: hidden;\n        -o-text-overflow: "."; text-overflow: "."; display: -webkit-box;\n        -webkit-line-clamp: 1; line-clamp: 1; -webkit-box-orient: vertical;\n        margin-left: -0.03em; line-height: 1.3;\n      }\n      .new-interface-info__details {\n        margin-bottom: 1.6em; display: flex; align-items: center; flex-wrap: wrap;\n        min-height: 1.9em; font-size: 1.1em;\n      }\n      .new-interface-info__split { margin: 0 1em; font-size: 0.7em; }\n      .new-interface-info__description {\n        font-size: 1.2em; font-weight: 300; line-height: 1.5; overflow: hidden;\n        -o-text-overflow: "."; text-overflow: "."; display: -webkit-box;\n        -webkit-line-clamp: 4; line-clamp: 4; -webkit-box-orient: vertical;\n        width: 70%;\n      }\n      .new-interface .card-more__box { padding-bottom: 95%; }\n      .new-interface .full-start__background { height: calc(100vh + 6em); top: -6em; }\n      .new-interface .full-start__overlay {\n        position: absolute;\n        width: 100%;\n        height: calc(100vh + 6em);\n        background: #0006; top: -6em;\n\n        width: 90vw;\n        background:\n          linear-gradient(to right,\n            rgba(0, 0, 0, 0.792) 0%,\n            rgba(0, 0, 0, 0.504) 50%,\n            rgba(0, 0, 0, 0.264) 70%, \n            rgba(0, 0, 0, 0.12) 80%, \n            rgba(0, 0, 0, 0) 100%\n          );\n      }\n      .new-interface .full-start__rate { font-size: 1.3em; margin-right: 0; }\n      .new-interface .card__promo { display: none; }\n      .new-interface .card.card--wide+.card-more .card-more__box { padding-bottom: 95%; }\n      .new-interface .card.card--wide .card-watched { display: none !important; }\n      body.light--version .new-interface-info__body { width: 69%; padding-top: 1.5em; }\n      body.light--version .new-interface-info { height: 25.3em; }\n      body.advanced--animation:not(.no--animation) .new-interface .card--small.card--wide.focus .card__view{\n        animation: animation-card-focus 0.2s\n      }\n      body.advanced--animation:not(.no--animation) .new-interface .card--small.card--wide.animate-trigger-enter .card__view{\n        animation: animation-trigger-enter 0.2s forwards\n      }\n      </style>\n      '),$("body").append(Lampa.Template.get("new_interface_style",{},!0))}()}();