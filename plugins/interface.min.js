!function(){"use strict";function n(){var n,e,t=new Lampa.Reguest,i={};this.create=function(){n=$('<div class="new-interface-info">\n        <div class="new-interface-info__body">\n        <div class="new-interface-info__head"></div>\n        <div class="new-interface-info__title"></div>\n        <div class="new-interface-info__details"></div>\n        <div class="new-interface-info__description"></div>\n        </div>\n        </div>')},this.update=function(e){n.find(".new-interface-info__head,.new-interface-info__details").text("---"),n.find(".new-interface-info__title").text(e.title),n.find(".new-interface-info__description").text(e.overview||Lampa.Lang.translate("full_notext")),Lampa.Background.change(Lampa.Api.img(e.backdrop_path,"w200")),this.load(e)},this.draw=function(e){var t=((e.release_date||e.first_air_date||"0000")+"").slice(0,4),i=parseFloat((e.vote_average||0)+"").toFixed(1),a=[],o=[],r=Lampa.Api.sources.tmdb.parseCountries(e),s=Lampa.Api.sources.tmdb.parsePG(e);"0000"!==t&&a.push("<span>"+t+"</span>"),r.length>0&&a.push(r.join(", ")),i>0&&o.push('<div class="full-start__rate"><div>'+i+"</div><div>TMDB</div></div>"),e.genres&&e.genres.length>0&&o.push(e.genres.map((function(n){return Lampa.Utils.capitalizeFirstLetter(n.name)})).join(" | ")),e.runtime&&o.push(Lampa.Utils.secondsToTime(60*e.runtime,!0)),s&&o.push('<span class="full-start__pg" style="font-size: 0.9em;">'+s+"</span>"),n.find(".new-interface-info__head").empty().append(a.join(", ")),n.find(".new-interface-info__details").html(o.join('<span class="new-interface-info__split">&#9679;</span>'))},this.load=function(n){var a=this;clearTimeout(e);var o=Lampa.TMDB.api((n.name?"tv":"movie")+"/"+n.id+"?api_key="+Lampa.TMDB.key()+"&append_to_response=content_ratings,release_dates&language="+Lampa.Storage.get("language"));if(i[o])return this.draw(i[o]);e=setTimeout((function(){t.clear(),t.timeout(5e3),t.silent(o,(function(n){i[o]=n,a.draw(n)}))}),300)},this.render=function(){return n},this.empty=function(){},this.destroy=function(){n.remove(),i={},n=null}}function e(e){var t,i,a,o=new Lampa.Reguest,r=new Lampa.Scroll({mask:!0,over:!0,scroll_by_item:!0}),s=[],d=$('<div class="new-interface"><img class="full-start__background"></div>'),c=0,l=Lampa.Manifest.app_digital>=166,f="view"==Lampa.Storage.field("card_views_type")||"mouse"==Lampa.Storage.field("navigation_type"),p=d.find(".full-start__background"),m="";this.create=function(){},this.empty=function(){var n;"tmdb"==e.source&&(n=$('<div class="empty__footer"><div class="simple-button selector">'+Lampa.Lang.translate("change_source_on_cub")+"</div></div>")).find(".selector").on("hover:enter",(function(){Lampa.Storage.set("source","cub"),Lampa.Activity.replace({source:"cub"})}));var t=new Lampa.Empty;d.append(t.render(n)),this.start=t.start,this.activity.loader(!1),this.activity.toggle()},this.loadNext=function(){var n=this;this.next&&!this.next_wait&&s.length&&(this.next_wait=!0,this.next((function(e){n.next_wait=!1,e.forEach(n.append.bind(n)),Lampa.Layer.visible(s[c+1].render(!0))}),(function(){n.next_wait=!1})))},this.push=function(){},this.build=function(a){var o=this;i=a,(t=new n(e)).create(),r.minus(t.render()),a.slice(0,f?a.length:2).forEach(this.append.bind(this)),d.append(t.render()),d.append(r.render()),l&&(Lampa.Layer.update(d),Lampa.Layer.visible(r.render(!0)),r.onEnd=this.loadNext.bind(this),r.onWheel=function(n){Lampa.Controller.own(o)||o.start(),n>0?o.down():c>0&&o.up()}),this.activity.loader(!1),this.activity.toggle()},this.background=function(n){var e=Lampa.Api.img(n.backdrop_path,"w1280");clearTimeout(a),e!=m&&(a=setTimeout((function(){p.removeClass("loaded"),p[0].onload=function(){p.addClass("loaded")},p[0].onerror=function(){p.removeClass("loaded")},m=e,setTimeout((function(){p[0].src=m}),300)}),1e3))},this.append=function(n){var i=this;if(!n.ready){n.ready=!0;var a=new Lampa.InteractionLine(n,{url:n.url,card_small:!0,cardClass:n.cardClass,genres:e.genres,object:e,card_wide:!0,nomore:n.nomore});a.create(),a.onDown=this.down.bind(this),a.onUp=this.up.bind(this),a.onBack=this.back.bind(this),a.onToggle=function(){c=s.indexOf(a)},this.onMore&&(a.onMore=this.onMore.bind(this)),a.onFocus=function(n){t.update(n),i.background(n)},a.onHover=function(n){t.update(n),i.background(n)},a.onFocusMore=t.empty.bind(t),r.append(a.render()),s.push(a)}},this.back=function(){Lampa.Activity.backward()},this.down=function(){c++,c=Math.min(c,s.length-1),f||i.slice(0,c+2).forEach(this.append.bind(this)),s[c].toggle(),r.update(s[c].render())},this.up=function(){--c<0?(c=0,Lampa.Controller.toggle("head")):(s[c].toggle(),r.update(s[c].render()))},this.start=function(){var n=this;Lampa.Controller.add("content",{link:this,toggle:function(){if(n.activity.canRefresh())return!1;s.length&&s[c].toggle()},update:function(){},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:this.back}),Lampa.Controller.toggle("content")},this.refresh=function(){this.activity.loader(!0),this.activity.need_refresh=!0},this.pause=function(){},this.stop=function(){},this.render=function(){return d},this.destroy=function(){o.clear(),Lampa.Arrays.destroy(s),r.destroy(),t&&t.destroy(),d.remove(),s=null,o=null,i=null}}window.plugin_interface_ready||function(){window.plugin_interface_ready=!0;var n=Lampa.InteractionMain,t=e;Lampa.InteractionMain=function(e){var i=t;return"tmdb"!=e.source&&"cub"!=e.source&&(i=n),window.innerWidth<767&&(i=n),Lampa.Manifest.app_digital<153&&(i=n),new i(e)},Lampa.Template.add("new_interface_style",'\n      <style>\n      .new-interface .card--small.card--wide {\n        width: 18.3em;\n      }\n      .new-interface-info {\n        position: relative;\n        padding: 1.5em;\n        height: 24em;\n      }\n      .new-interface-info__body {\n        width: 80%;\n        padding-top: 1.1em;\n      }\n      .new-interface-info__head {\n        color: rgba(255, 255, 255, 0.6);\n        margin-bottom: 1em;\n        font-size: 1.3em;\n        min-height: 1em;\n      }\n      .new-interface-info__head span {\n        color: #fff;\n      }\n      .new-interface-info__title {\n        font-size: 4em;\n        font-weight: 600;\n        margin-bottom: 0.3em;\n        overflow: hidden;\n        -o-text-overflow: ".";\n        text-overflow: ".";\n        display: -webkit-box;\n        -webkit-line-clamp: 1;\n        line-clamp: 1;\n        -webkit-box-orient: vertical;\n        margin-left: -0.03em;\n        line-height: 1.3;\n      }\n      .new-interface-info__details {\n        margin-bottom: 1.6em;\n        display: -webkit-box;\n        display: -webkit-flex;\n        display: -moz-box;\n        display: -ms-flexbox;\n        display: flex;\n        -webkit-box-align: center;\n        -webkit-align-items: center;\n        -moz-box-align: center;\n        -ms-flex-align: center;\n        align-items: center;\n        -webkit-flex-wrap: wrap;\n        -ms-flex-wrap: wrap;\n        flex-wrap: wrap;\n        min-height: 1.9em;\n        font-size: 1.1em;\n      }\n      .new-interface-info__split {\n        margin: 0 1em;\n        font-size: 0.7em;\n      }\n      .new-interface-info__description {\n        font-size: 1.2em;\n        font-weight: 300;\n        line-height: 1.5;\n        overflow: hidden;\n        -o-text-overflow: ".";\n        text-overflow: ".";\n        display: -webkit-box;\n        -webkit-line-clamp: 4;\n        line-clamp: 4;\n        -webkit-box-orient: vertical;\n        width: 70%;\n      }\n      .new-interface .card-more__box {\n        padding-bottom: 95%;\n      }\n      .new-interface .full-start__background {\n        height: 108%;\n        top: -6em;\n      }\n      .new-interface .full-start__rate {\n        font-size: 1.3em;\n        margin-right: 0;\n      }\n      .new-interface .card__promo {\n        display: none;\n      }\n      .new-interface .card.card--wide+.card-more .card-more__box {\n        padding-bottom: 95%;\n      }\n      .new-interface .card.card--wide .card-watched {\n        display: none !important;\n      }\n      body.light--version .new-interface-info__body {\n        width: 69%;\n        padding-top: 1.5em;\n      }\n      body.light--version .new-interface-info {\n        height: 25.3em;\n      }\n      body.advanced--animation:not(.no--animation) .new-interface .card--small.card--wide.focus .card__view{\n        animation: animation-card-focus 0.2s\n      }\n      body.advanced--animation:not(.no--animation) .new-interface .card--small.card--wide.animate-trigger-enter .card__view{\n        animation: animation-trigger-enter 0.2s forwards\n      }\n      </style>\n      '),$("body").append(Lampa.Template.get("new_interface_style",{},!0))}()}();