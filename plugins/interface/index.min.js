!function(){"use strict";function e(e){if("function"!=typeof e)return e;if(e.__abs_url_safe)return e;function t(t,...n){return"string"!=typeof(i=t)||0!==i.indexOf("http://")&&0!==i.indexOf("https://")&&0!==i.indexOf("//")?e.call(this,t,...n):t;var i}return t.__abs_url_safe=!0,t.__orig=e,t}function t(e,t,n){if(e)try{var i=e[t];Object.defineProperty(e,t,{configurable:!0,enumerable:!0,get:function(){return i},set:function(e){i=e;try{n(e)}catch(e){}}}),i&&n(i)}catch(e){}}function n(){const e=/^(shots|шоты)$/i,t=["onClick","onSelect","onEnter","callback","handler","action","run"];function n(t){return"string"==typeof t&&e.test(t.trim())}function i(e){e=e||{};const i=Number.isFinite(e.tries)?e.tries:12,a=Number.isFinite(e.delay)?e.delay:150;let r=0;!function e(){r++;try{const e=function(){if(!window.Lampa||!Lampa.Menu)return null;const e=Lampa.Menu,i=new Set,a=[];for([e.buttons,e.items,e.list,e._buttons,e._items,e.menu,e].forEach((e=>e&&a.push(e)));a.length;){const e=a.pop();if(!e)continue;const r=typeof e;if(("object"===r||"function"===r)&&!i.has(e))if(i.add(e),Array.isArray(e))for(const t of e)a.push(t);else if("object"===r){if(n(e.name??e.title??e.text??e.label??e.id))for(const n of t)if("function"==typeof e[n])return e[n];for(const t in e){if(!Object.prototype.hasOwnProperty.call(e,t))continue;const n=e[t];n&&"object"==typeof n&&a.push(n)}}}return null}();if("function"==typeof e)return void e();if(function(){if(!window.$)return!1;const e=$(".selector").filter((function(){const e=(this.textContent||"").trim(),t=(this.getAttribute("data-title")||"").trim(),i=(this.getAttribute("data-name")||"").trim();return n(e)||n(t)||n(i)})).first();return!!e.length&&(e.trigger("hover:enter"),e.trigger("click"),!0)}())return}catch(e){}if(r<i)return setTimeout(e,a);window.Lampa&&Lampa.Bell&&Lampa.Bell.push({icon:'<svg><use xlink:href="#sprite-shots"></use></svg>',text:"Shots: handler/button not found in menu (Shots plugin not loaded?)"})}()}window.ShotsLauncher=window.ShotsLauncher||{},window.ShotsLauncher.open=i,window.ShotsLauncher.bindMoreButton=function(e){if(!e)return;const t=e.querySelector(".items-line__more")||e.querySelector(".line__more")||e.querySelector(".items-more")||e.querySelector(".more");if(!t)return;const n=function(e){try{e.preventDefault(),e.stopPropagation()}catch(e){}i()};t.addEventListener("click",n,!0),window.$&&$(t).off("hover:enter.shots_open").on("hover:enter.shots_open",n)}}function i(e){if(!e)return"";try{if(Lampa&&Lampa.Utils&&"function"==typeof Lampa.Utils.parseTime){var t=Lampa.Utils.parseTime(e),n=t&&t.full?String(t.full):"";return n=(n=(n=n.trim()).replace(/\s+\d{4}\s*$/,"").trim()).replace(/^(\d+\s+)(.)/,(function(e,t,n){return t+String(n).toUpperCase()}))}}catch(e){}var i,a=new Date(String(e).replace(/-/g,"/"));if(isNaN(a.getTime()))return String(e);try{var r=Lampa.Storage&&Lampa.Storage.get&&Lampa.Storage.get("language")||"ru",o=new Intl.DateTimeFormat(r,{month:"long"}).format(a);return i=o,o=(i=String(i||""))?i.charAt(0).toUpperCase()+i.slice(1):i,a.getDate()+" "+o}catch(t){return String(e)}}function a(){var e,t,n=new Lampa.Reguest,i={},a="";function r(t,n){e.find(t).text(n||"")}function o(t){var n=t&&t.overview?String(t.overview).trim():"";n?r(".new-interface-info__description",n):e.find(".new-interface-info__description").text().trim()||r(".new-interface-info__description",Lampa.Lang.translate("full_notext"))}this.create=function(){e=$('<div class="new-interface-info">\n          <div class="new-interface-info__body">\n            <div class="new-interface-info__head"></div>\n            <div class="new-interface-info__title"></div>\n            <div class="new-interface-info__details"></div>\n            <div class="new-interface-info__description"></div>\n          </div>\n        </div>')},this.update=function(t){t=t||{},e.find(".new-interface-info__head,.new-interface-info__details").text("---"),r(".new-interface-info__title",t.title||t.name||"");var n=String(t.overview||"").trim();r(".new-interface-info__description",n||""),t.backdrop_path&&Lampa.Background.change(Lampa.Api.img(t.backdrop_path,"w200")),t.id&&this.load(t)},this.draw=function(t){var n=String(t.release_date||t.first_air_date||"0000").slice(0,4),i=parseFloat(String(t.vote_average||0)).toFixed(1),a=[],r=[],o=Lampa.Api.sources.tmdb.parseCountries(t),s=Lampa.Api.sources.tmdb.parsePG(t);"0000"!==n&&a.push("<span>"+n+"</span>"),o.length&&a.push(o.join(", ")),Number(i)>0&&r.push('<div class="full-start__rate"><div>'+i+"</div><div>TMDB</div></div>"),t.genres&&t.genres.length&&r.push(t.genres.map((function(e){return Lampa.Utils.capitalizeFirstLetter(e.name)})).join(" | ")),t.runtime&&r.push(Lampa.Utils.secondsToTime(60*t.runtime,!0)),s&&r.push('<span class="full-start__pg" style="font-size: 0.9em;">'+s+"</span>"),e.find(".new-interface-info__head").empty().append(a.join(", ")),e.find(".new-interface-info__details").html(r.join('<span class="new-interface-info__split">&#9679;</span>'))},this.load=function(e){var r=this;if(clearTimeout(t),e&&e.id){var s=Lampa.TMDB.api((e.name?"tv":"movie")+"/"+e.id+"?api_key="+Lampa.TMDB.key()+"&append_to_response=content_ratings,release_dates&language="+Lampa.Storage.get("language"));if(a=s,i[s])return o(i[s]),void this.draw(i[s]);t=setTimeout((function(){n.clear(),n.timeout(5e3),n.silent(s,(function(e){i[s]=e,a===s&&(o(e),r.draw(e))}))}),200)}},this.render=function(){return e},this.empty=function(){},this.destroy=function(){e&&e.remove(),i={},e=null}}function r(e){if(e){!e.backdrop_path&&e.screen&&(e.backdrop_path=e.screen),!e.poster_path&&e.screen&&(e.poster_path=e.screen),!e.poster_path&&e.card_poster&&(e.poster_path=e.card_poster),!e.title&&e.card_title&&(e.title=e.card_title);var t=e.card_id?parseInt(e.card_id,10):null;e.card||(e.card={}),t&&(e.card.id=t),e.card.source=e.card.source||"tmdb",e.card.type=String(e.card.type||e.card_type||"movie").toLowerCase(),"tv"!==e.card.type&&"movie"!==e.card.type&&(e.card.type="movie"),!e.card.poster_path&&e.card_poster&&(e.card.poster_path=e.card_poster),!e.card.backdrop_path&&e.backdrop_path&&(e.card.backdrop_path=e.backdrop_path),null!=e.id&&null==e.shot_id&&(e.shot_id=e.id),t&&(e.id=t),"movie"===e.card.type?(e.card.title=e.card.title||e.card_title||e.title||"",e.card.name&&delete e.card.name,e.name&&delete e.name,!e.card.release_date&&e.card_year&&(e.card.release_date=e.card_year+"-01-01"),e.card.first_air_date&&delete e.card.first_air_date):(e.card.name=e.card.name||e.card_title||e.name||e.title||"",e.card.title&&delete e.card.title,!e.name&&e.card_title&&(e.name=e.card_title),!e.card.first_air_date&&e.card_year&&(e.card.first_air_date=e.card_year+"-01-01"),e.card.release_date&&delete e.card.release_date)}}function o(e){if(!e||!Array.isArray(e.results)||!e.results.length)return!1;var t=e.results[0];return!!t&&!!(t.episode||t.air_date&&null!=t.season_number&&null!=t.episode_number)}function s(e){if(!e||!Array.isArray(e.results)||!e.results.length)return!1;if("shots"===String(e.title||e.name||"").toLowerCase())return!0;var t=e.results[0];return!!(t&&t.screen&&t.file&&t.card_id)}function c(e){return!!(e&&e.screen&&e.file&&e.card_id)}function d(e,t){var n=e&&e.jquery?e[0]:e;if(n&&t&&!n.__shots_reactive_attached){n.__shots_reactive_attached=!0;var i=!1;if(o(),"undefined"!=typeof MutationObserver){var a=new MutationObserver((function(e){for(var t=0;t<e.length;t++)if(e[t]&&e[t].addedNodes&&e[t].addedNodes.length)return void o()}));a.observe(n,{childList:!0,subtree:!0}),n.__shots_obs=a}}function o(){i||(i=!0,setTimeout((function(){i=!1,function(){var e=$(n);!function(e){var t=e.find(".items-line__title").first();if(t.length||(t=e.find(".line__title").first()),t.length||(t=e.find(".interaction-line__title").first()),t.length&&!t.find(".full-person").length){var n=$('<div class="full-person layer--visible full-person--small full-person--loaded full-person--svg">\n        <div class="full-person__photo" style="background-color:#fff;color:rgb(253,69,24)">\n          <svg><use xlink:href="#sprite-shots"></use></svg>\n        </div>\n        <div class="full-person__body">\n          <div class="full-person__name">Shots</div>\n        </div>\n      </div>');t.empty().append(n)}}(e);var i=e.find(".card");if(!i.length)return;var a=t&&t.results||[];i.each((function(e){var t=a[e]||function(e){try{var t=$(e),n=t.data&&t.data();if(!n)return null;for(var i in n){var a=n[i];if(c(a))return a;if(a&&a.card&&c(a))return a}if(c(n))return n}catch(e){}return null}(this);t&&(r(t),function(e,t){if(t){var n=e.find(".card__view");if(n.length||(n=e),!n.find(".full-episode__shot-icon").length){for(var i,a,r,o,s,c,d=$('<div class="full-episode__shot-icon">\n        <svg><use xlink:href="#sprite-shots"></use></svg>\n      </div>'),l=null==t.liked?0:t.liked,p=(i=t,a=[],r=String(i.card_type||i.card&&i.card.type||"").toLowerCase(),o=parseInt(i.season,10),s=parseInt(i.episode,10),c=(i.voice_name||"").split(/[\s|,|.]+/)[0].replace(/[\s][^a-zA-Zа-яА-Я0-9].*$/,"").trim(),"tv"===r?(o>0&&a.push("S-"+o),s>0&&a.push("E-"+s),c&&a.push(c)):c&&a.push(c),a),f=$('<div class="shots-tags"></div>'),u=0;u<p.length;u++)f.append("<div>"+String(p[u])+"</div>");var h=$('<div class="full-episode__liked">\n        <svg><use xlink:href="#sprite-love"></use></svg>\n        <span></span>\n      </div>');h.find("span").text(String(l));var m=$('<div class="full-episode__date"></div>');m.append(f),m.append(h);var _=$('<div class="full-episode__body"></div>');_.append(m),n.append(_),n.append(d)}}}($(this),t))}))}()}),0))}}function l(e){var t,c,l,p=new Lampa.Reguest,f=new Lampa.Scroll({mask:!0,over:!0,scroll_by_item:!0}),u=[],h=$('<div class="new-interface">\n        <img class="full-start__background">\n        <div class="full-start__overlay"></div>\n      </div>'),m=0,_=Lampa.Manifest.app_digital>=166,v="view"==Lampa.Storage.field("card_views_type")||"mouse"==Lampa.Storage.field("navigation_type"),g=h.find(".full-start__background"),w="";this.emit={},this.use=function(e){for(var t in e=e||{})this.emit[t]=e[t];if("function"==typeof this.emit.onNext){var n=this;this.next=function(e,t){return n.emit.onNext.call(n,e,t)}}return this},this.create=function(){this.emit&&"function"==typeof this.emit.onCreate&&this.emit.onCreate.call(this)},this.empty=function(){var t;"tmdb"==e.source&&(t=$('<div class="empty__footer"><div class="simple-button selector">'+Lampa.Lang.translate("change_source_on_cub")+"</div></div>")).find(".selector").on("hover:enter",(function(){Lampa.Storage.set("source","cub"),Lampa.Activity.replace({source:"cub"})}));var n=new Lampa.Empty;h.append(n.render(t)),this.start=n.start,this.activity.loader(!1),this.activity.toggle()},this.loadNext=function(){var e=this;this.next&&!this.next_wait&&u.length&&(this.next_wait=!0,this.next((function(t){e.next_wait=!1,t.forEach(e.append.bind(e)),u[m+1]&&Lampa.Layer.visible(u[m+1].render(!0))}),(function(){e.next_wait=!1})))},this.build=function(e){var n=this;c=e,(t=new a).create(),f.minus(t.render()),e.slice(0,v?e.length:2).forEach(this.append.bind(this)),h.append(t.render()),h.append(f.render()),_&&(Lampa.Layer.update(h),Lampa.Layer.visible(f.render(!0)),f.onEnd=this.loadNext.bind(this),f.onWheel=function(e){Lampa.Controller.own(n)||n.start(),e>0?n.down():m>0&&n.up()}),this.activity.loader(!1),this.activity.toggle()},this.background=function(e){var t=e&&e.card?e.card:e;if(t&&t.backdrop_path){var n=Lampa.Api.img(t.backdrop_path,"w1280");clearTimeout(l),n!=w&&(l=setTimeout((function(){g.removeClass("loaded"),g[0].onload=function(){g.addClass("loaded")},g[0].onerror=function(){g.removeClass("loaded")},w=n,setTimeout((function(){g[0].src=w}),200)}),600))}},this.append=function(a){var c=this;if(!a.ready){a.ready=!0,a&&Array.isArray(a.results)&&(o(a)?a.results.forEach((function(e){!function(e){if(e){var t=e.episode||e,n=e.card||e.episode&&e.episode.card||null,i=t&&t.still_path?t.still_path:null;e.backdrop_path||(e.backdrop_path=i||n&&(n.backdrop_path||n.poster_path)||e.poster_path||null),e.poster_path||(e.poster_path=i||n&&(n.poster_path||n.backdrop_path)||e.backdrop_path||null),null!=e.id&&null==e.episode_id&&(e.episode_id=e.id),n&&null!=n.id&&(e.id=n.id),n&&(!e.name&&n.name&&(e.name=n.name),!e.title&&n.title&&(e.title=n.title),!e.overview&&n.overview&&(e.overview=n.overview),!e.source&&n.source&&(e.source=n.source))}}(e)})):s(a)&&a.results.forEach((function(e){r(e)})));var l=new Lampa.InteractionLine(a,{url:a.url,card_small:!0,cardClass:a.cardClass,genres:e.genres,object:e,card_wide:!0,nomore:a.nomore});if(l&&"function"!=typeof l.use&&(l.use=function(e){for(var t in e=e||{},this._emit=this._emit||{},e)this._emit[t]=e[t];return"function"==typeof e.onMore&&(this.onMore=e.onMore),"function"==typeof e.onInstance&&(this.onInstance=e.onInstance),void 0!==e.module&&(this.module=e.module),this}),this.emit&&"function"==typeof this.emit.onInstance)try{this.emit.onInstance.call(this,l,a)}catch(e){}l.create(),l.onDown=this.down.bind(this),l.onUp=this.up.bind(this),l.onBack=this.back.bind(this),l.onToggle=function(){m=u.indexOf(l)};var p=l.onFocus,h=l.onHover;l.onFocus=function(e){"function"==typeof p&&p(e);var n=e&&e.card?e.card:e;t.update(n||{}),c.background(e||n||{})},l.onHover=function(e){"function"==typeof h&&h(e);var n=e&&e.card?e.card:e;t.update(n||{}),c.background(e||n||{})},l.onFocusMore=t.empty.bind(t);var _=l.render();if(a&&Array.isArray(a.results)&&s(a)){l.onMore=function(){return window.ShotsLauncher&&"function"==typeof ShotsLauncher.open||n(),ShotsLauncher.open(),!1};try{l&&"function"==typeof l.use&&l.use({onMore:l.onMore})}catch(e){}}f.append(_),u.push(l),a&&Array.isArray(a.results)&&(o(a)&&function(e,t){var n=e&&e.jquery?e[0]:e;function a(){var e=$(n).find(".card");return!!e.length&&(e.each((function(e){var n=t[e];if(n){var a=n.episode||n,r=a.season_number,o=a.episode_number,s=a.air_date;if(null!=r&&null!=o&&s){var c=$(this),d=c.find(".card__view");if(d.length||(d=c),!d.find(".plugin-epmeta--episode").length){var l=(a.name||"").trim()||"Эпизод "+o,p=i(s),f=$('<div class="plugin-epmeta plugin-epmeta--episode">\n            <div class="plugin-epmeta__ep"></div>\n            <div class="plugin-epmeta__date"></div>\n          </div>');f.find(".plugin-epmeta__ep").text(l),f.find(".plugin-epmeta__date").text(p),d.append(f)}}}})),!0)}n&&t&&t.length&&(a()||("undefined"!=typeof MutationObserver?new MutationObserver((function(){a()})).observe(n,{childList:!0,subtree:!0}):setTimeout(a,0)))}(_,a.results),s(a)&&d(_,a))}},this.back=function(){Lampa.Activity.backward()},this.down=function(){m++,m=Math.min(m,u.length-1),v||c.slice(0,m+2).forEach(this.append.bind(this)),u[m].toggle(),f.update(u[m].render())},this.up=function(){--m<0?(m=0,Lampa.Controller.toggle("head")):(u[m].toggle(),f.update(u[m].render()))},this.start=function(){var e=this;Lampa.Controller.add("content",{link:this,toggle:function(){if(e.activity.canRefresh())return!1;u.length&&u[m].toggle()},update:function(){},left:function(){Navigator.canmove("left")?Navigator.move("left"):Lampa.Controller.toggle("menu")},right:function(){Navigator.move("right")},up:function(){Navigator.canmove("up")?Navigator.move("up"):Lampa.Controller.toggle("head")},down:function(){Navigator.canmove("down")&&Navigator.move("down")},back:this.back}),Lampa.Controller.toggle("content")},this.refresh=function(){this.activity.loader(!0),this.activity.need_refresh=!0},this.pause=function(){},this.stop=function(){},this.render=function(){return h},this.destroy=function(){p.clear(),Lampa.Arrays.destroy(u),f.destroy(),t&&t.destroy(),h.remove(),u=null,p=null,c=null}}!function(){if(!window.plugin_interface_ready){if(window.plugin_interface_ready=!0,i(),t(Lampa,"Api",(function(){i()})),t(Lampa,"TMDB",(function(){i()})),Lampa.Utils&&"function"==typeof Lampa.Utils.createInstance)a(Lampa.Utils);else{t(Lampa,"Utils",(function(e){a(e)}));var n=Lampa.InteractionMain;Lampa.InteractionMain=function(e){var t=l;return"tmdb"!==e.source&&"cub"!==e.source&&(t=n),window.innerWidth<767&&(t=n),Lampa.Manifest.app_digital<153&&(t=n),new t(e)}}Lampa.Template.add("new_interface_style",'<style>\n        .new-interface .card__view { position: relative; }\n        .new-interface .card--small.card--wide { width: 19.6em; }\n        .new-interface-info { position: relative; padding: 1.5em; height: 24em; }\n        .new-interface-info__body { width: 80%; padding-top: 1.1em; }\n        .new-interface-info__head { color: rgba(255, 255, 255, 0.6); margin-bottom: 1em; font-size: 1.3em; min-height: 1em; }\n        .new-interface-info__head span { color: #fff; }\n        .new-interface-info__title { font-size: 4em; font-weight: 600; margin-bottom: 0.3em; overflow: hidden; text-overflow: "."; display: -webkit-box; -webkit-line-clamp: 1; -webkit-box-orient: vertical; margin-left: -0.03em; line-height: 1.3; }\n        .new-interface-info__details { margin-bottom: 1.6em; display: flex; align-items: center; flex-wrap: wrap; min-height: 1.9em; font-size: 1.1em; }\n        .new-interface-info__split { margin: 0 1em; font-size: 0.7em; }\n        .new-interface-info__description { font-size: 1.2em; font-weight: 300; line-height: 1.5; overflow: hidden; text-overflow: "."; display: -webkit-box; -webkit-line-clamp: 4; -webkit-box-orient: vertical; width: 70%; }\n        .new-interface .full-start__background { height: calc(100vh + 6em); top: -6em; }\n        .new-interface .full-start__overlay { position: absolute; width: 90vw; height: calc(100vh + 6em); top: -6em;\n          background: linear-gradient(to right, rgba(0,0,0,0.792) 0%, rgba(0,0,0,0.504) 50%, rgba(0,0,0,0.264) 70%, rgba(0,0,0,0.12) 80%, rgba(0,0,0,0) 100%); }\n        .new-interface .card__promo { display: none; }\n        .new-interface .card.card--wide .card-watched { display: none !important; }\n\n        .new-interface .plugin-epmeta--episode { position: absolute; left: 0; right: 0; bottom: 0; padding: 0.6em 0.75em;\n          background: linear-gradient(to top, rgba(0,0,0,0.72), rgba(0,0,0,0)); border-radius: 0 0 1em 1em; }\n        .new-interface .plugin-epmeta--episode .plugin-epmeta__ep { font-size: 1.05em; font-weight: 700; line-height: 1.15; margin-bottom: 0.15em; }\n        .new-interface .plugin-epmeta--episode .plugin-epmeta__date { font-size: 0.95em; line-height: 1.15; opacity: 0.9; }\n\n        .new-interface .full-episode__shot-icon { position: absolute; top: 1em; left: 1em; z-index: 5; }\n        .new-interface .full-episode__shot-icon svg { width: 2em !important; height: 2em !important; }\n        .new-interface .full-episode__body { display: flex; background: linear-gradient(0, rgba(0,0,0,0.5) 0, rgba(0,0,0,0) 40%); }\n        .new-interface .full-episode__date { display: flex; justify-content: space-between; align-items: center; gap: 0.3em; }\n        .new-interface .shots-tags { display: flex; flex-wrap: wrap; }\n        .new-interface .shots-tags > div { background: rgba(0,0,0,0.5); }\n        .new-interface .full-episode__liked { display: flex; align-items: center; gap: 0.35em; }\n        .new-interface .full-episode__liked svg { width: 1.05em; height: 1.05em; }\n\n        body.light--version .new-interface-info__body { width: 69%; padding-top: 1.5em; }\n        body.light--version .new-interface-info { height: 25.3em; }\n      </style>'),$("body").append(Lampa.Template.get("new_interface_style",{},!0))}function i(){try{window.Api&&"function"==typeof window.Api.img&&(window.Api.img=makeAbsUrlSafe(window.Api.img))}catch(e){}try{Lampa&&Lampa.Api&&function(t,n){if(t){var i=e(t[n]);try{Object.defineProperty(t,n,{configurable:!0,enumerable:!0,get:function(){return i},set:function(t){i=e(t)}}),i=e(t[n])}catch(e){t[n]=i}}}(Lampa.Api,"img")}catch(e){}}function a(e){if(e&&"function"==typeof e.createInstance&&!e.createInstance.__new_interface_patched){e.createInstance.__new_interface_patched=!0;var t=e.createInstance;e.createInstance=function(e,n,i,a){var r;return i=i||{},!(r=n=n||{})||"object"!=typeof r||"tmdb"!==r.source&&"cub"!==r.source||"main"!==r.component&&"category"!==r.component||window.innerWidth<767||Lampa.Manifest.app_digital<153||((i=function(e,t){for(var n in e=e||{},t=t||{})e[n]=t[n];return e}({},i)).createInstance=function(e){return new l(e)},a=!0),t.call(this,e,n,i,a)}}}}()}();